{% extends 'base.html' %}

{% block content %}


    <form action="/login/" method="post" class="loginForm">
        {% csrf_token %}
        <div class='container'>
            <div class='loginform'>
                <div class='loginform-ins'>
                    <div class='row'>
                        <div class='col-sm-6'>
                            <div class='form-group'>
                                <input class='loginInput form-control' type='text' maxlength='8' name='username' placeholder='Login'>
                            </div>
                            <div class='form-group'>
                                <input class='passwordInput form-control' type='password' maxlength='8' name='password' placeholder='Password'>
                            </div>
                        </div>
                        <div class='col-sm-6'>
                            <div class='formBtns'>
                                <div class='form-group'>
                                    <input class='loginBtn btn btn-default btn-success1 login-submit' type='submit' name='action' value='login'>
                                </div>
                                <div class='form-group'>
                                     <input class='regBtn btn btn-default btn-info1 reg-submit' type='submit' name='action' value='register'>
                                </div>
                                <div class='form-group'>
                                    <input class='anonBtn btn btn-default btn-danger1 anonym-submit' type='submit' name='action' value='anonymous'>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class='clr'></div>
        </div>
    </form>

    <script>
        var actionParam;
        var result;

        $('.loginForm').on('submit', function (event) {
            event.preventDefault();
            submitParams(actionParam);
        });

        $('.loginBtn').click(function (event) {
            actionParam = 'login';
        });

        $('.regBtn').click(function (event) {
            actionParam = 'register';
        });

        $('.anonBtn').click(function (event) {
            actionParam = 'anonymous';
        });


        function submitParams(action) {
            var url = $('.loginForm').attr('action');
            var login = $('.loginInput').val();
            var pass = $('.passwordInput').val();
            var token = $('input[name=csrfmiddlewaretoken]').val();
            $.post(url, {
                'username': login,
                'password': pass,
                'action': action,
                'csrfmiddlewaretoken': token
            }).done(positiveHandler)
                .fail(negativeHandler);
        }

        function positiveHandler(data) {
            location.href = data.redirect_url
        }

        function negativeHandler(data) {
            var resp = data.responseJSON;
            if (resp.message.username) {
                alert(resp.message.username)
            }
            if (resp.message.password) {
                alert(resp.message.password)
            }
            // TODO what to fo if 500?
        }


    </script>
{% endblock %}